var W=[1,9,9,8,8,8,8,7,9,8,9,9,8,9,9,9,8,8,8,8,9,9,8,9,8,8,8,8,8,9,9,9,4,2,5,6,6,6,6,3,5,5,5,6,2,6,2,6,6,6,6,6,6,6,6,6,6,6,2,2,5,6,5,6,7,6,6,6,6,6,6,6,6,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,4,6,6,3,6,6,6,6,6,5,6,6,2,6,5,3,6,6,6,6,6,6,6,4,6,6,6,6,6,6,5,2,5,7,6,6,6,6,6,6,6,6,6,6,6,6,4,6,3,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,6,3,6,6,6,6,6,6,6,7,6,6,6,2,6,6,8,9,9,6,6,6,8,8,6,8,8,8,8,8,6,6,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,9,9,9,5,9,9,8,7,7,8,7,8,8,8,7,8,8,7,9,9,6,7,7,7,7,7,9,6,7,8,7,6,6,9,7,6,7,1],B=.247,R=.1484375,cfg=window.eaglercraftXPreview,el=cfg.widget,w=el.clientWidth,h=Math.floor(w*R);el.style.width=w+"px";el.style.height=h+"px";el.style.backgroundColor="black";var cv=document.createElement("canvas");cv.width=w;cv.height=h;el.appendChild(cv);var ctx=cv.getContext("2d");ctx.imageSmoothingEnabled=!1;var tmp=document.createElement("canvas");tmp.width=64;tmp.height=64;var tctx=tmp.getContext("2d");tctx.imageSmoothingEnabled=!1;var img=new Image,loaded=0,st={n:cfg.name,c:!1,pt:0,p:-1,m1:"",m2:null,on:0,mx:0},dirty=1,conn=0,ico=null,icoctx=null,tip="",showtip=0,tipcv=document.createElement("canvas");tipcv.width=64;tipcv.height=64;tipcv.style.display="none";tipcv.style.position="fixed";tipcv.style.zIndex="100";tipcv.style.pointerEvents="none";document.body.appendChild(tipcv);var tipctx=tipcv.getContext("2d");tipctx.imageSmoothingEnabled=!1;var mx=0,my=0,mpx=0,mpy=0,over=0,timer=0,lastw=0;var px=t=>t*w/256,py=t=>t*h/38,di=(x,y,w2,h2,dx,dy,dw,dh)=>{loaded&&ctx.drawImage(img,x+.05,y+.05,w2-.1,h2-.1,px(dx),py(dy),px(dw||w2),py(dh||h2))},dc=(x,y,c,i)=>{if(c>=W.length)c=176;if(i){ctx.resetTransform();ctx.scale(w/256,h/38);ctx.translate(x+1.1,y);ctx.transform(1,0,-.35,1,0,0);ctx.drawImage(img,c%16*8,8*Math.floor(c/16),.99*W[c],7.92,0,0,W[c],8);ctx.resetTransform()}else di(c%16*8,8*Math.floor(c/16),W[c],8,x,y);return W[c]},dcc=(x,y,c,col,i)=>{if(c>=W.length)c=176;if(loaded){tctx.globalCompositeOperation="source-over";tctx.clearRect(0,0,8,8);tctx.imageSmoothingEnabled=!1;tctx.drawImage(img,c%16*8,8*Math.floor(c/16),.99*W[c],7.92,0,0,W[c],8);tctx.globalCompositeOperation="source-in";tctx.fillStyle=col;tctx.fillRect(0,0,W[c],8);if(i){ctx.resetTransform();ctx.scale(w/256,h/38);ctx.translate(x+1.1,y);ctx.transform(1,0,-.35,1,0,0);ctx.drawImage(tmp,0,0,.99*W[c],7.92,0,0,W[c],8);ctx.resetTransform()}else ctx.drawImage(tmp,0,0,.99*W[c],7.92,px(x),py(y),px(W[c]),py(8))}return W[c]},dl=(x,y,w2,c)=>{ctx.fillStyle=c;ctx.fillRect(px(x),py(y),px(w2+.02),py(1))},mc=(r,g,b)=>"rgba("+Math.floor(r)+","+Math.floor(g)+","+Math.floor(b)+",1.0)",sw=(s,sc)=>{sc=sc?sc.charCodeAt(0):167;for(var i=0,j=0;j<s.length;++j){var c=s.charCodeAt(j);c==sc?j+=2:i=c<W.length?i+W[c]:i+6}return i},ds=(x,y,s,r,g,b,sh,rnd,sc)=>{var osc=sc;sc=sc?sc.charCodeAt(0):167;var ox=x,oy=y;sh&&(++x,++y);rnd=rnd||3492589035;for(var cf=0,cr=r,cg=g,cb=b,bo=0,un=0,st=0,it=0,ob=0,i=0;i<s.length;++i){var c=s.charCodeAt(i);if(c==sc)cf=1;else if(cf){if(c==48)cr=cg=cb=0,cf=bo=un=st=it=ob=0;else if(c==49)cr=cg=0,cb=170,cf=bo=un=st=it=ob=0;else if(c==50)cr=cb=0,cg=170,cf=bo=un=st=it=ob=0;else if(c==51)cr=0,cg=cb=170,cf=bo=un=st=it=ob=0;else if(c==52)cr=170,cg=cb=0,cf=bo=un=st=it=ob=0;else if(c==53)cr=cb=170,cg=0,cf=bo=un=st=it=ob=0;else if(c==54)cr=255,cg=170,cb=0,cf=bo=un=st=it=ob=0;else if(c==55)cr=cg=cb=170,cf=bo=un=st=it=ob=0;else if(c==56)cr=cg=cb=85,cf=bo=un=st=it=ob=0;else if(c==57)cr=cg=85,cb=255,cf=bo=un=st=it=ob=0;else if(c==97)cr=cb=85,cg=255,cf=bo=un=st=it=ob=0;else if(c==98)cr=85,cg=cb=255,cf=bo=un=st=it=ob=0;else if(c==99)cg=cb=85,cr=255,cf=bo=un=st=it=ob=0;else if(c==100)cr=cb=255,cg=85,cf=bo=un=st=it=ob=0;else if(c==101)cr=cg=255,cb=85,cf=bo=un=st=it=ob=0;else if(c==102)cr=cg=cb=255,cf=bo=un=st=it=ob=0;else if(c==107)cf=0,bo=1;else if(c==108)cf=0,un=1;else if(c==109)cf=0,st=1;else if(c==110)cf=0,it=1;else if(c==111)cf=0,ob=1;else if(c==114)cr=r,cg=g,cb=b,cf=bo=un=st=it=ob=0;else cf=0}else{if(bo){dirty=1;var wc=6;c<W.length&&(wc=W[c]);var at=0;do{var nr=rnd+=1831565813;nr=Math.imul(nr^nr>>>15,1|nr);nr^=nr+Math.imul(nr^nr>>>7,61|nr);nr=((nr^nr>>>14)>>>0)/429496&255}while((nr==c||W[nr]!=wc)&&1e3>++at);c=nr}if(sh){var col=mc(cr*B,cg*B,cb*B),sx=x;un&&dcc(x+1,y,c,col,ob);x+=wc=dcc(x,y,c,col,ob);un&&(++x,++wc);st&&dl(sx,y+4,wc,col);it&&dl(sx,y+8,wc,col)}else if(250<=cr&&250<=cg&&250<=cb){sx=x;un&&dc(x+1,y,c,ob);x+=wc=dc(x,y,c,ob);un&&(++x,++wc);st&&dl(sx,y+4,wc,"#FFFFFF");it&&dl(sx,y+8,wc,"#FFFFFF")}else{col=mc(cr,cg,cb);sx=x;un&&dcc(x+1,y,c,col,ob);x+=wc=dcc(x,y,c,col,ob);un&&(++x,++wc);st&&dl(sx,y+4,wc,col);it&&dl(sx,y+8,wc,col)}if(250<x)break}}sh&&ds(ox,oy,s,r,g,b,0,rnd,osc)},draw=()=>{if(dirty||over&&0==++timer%2||w!=el.clientWidth){dirty=0;if(w!=el.clientWidth){h=Math.floor(el.clientWidth*R);el.style.height=h+"px";w=el.clientWidth;h=el.clientHeight;cv.width=w;cv.height=h}var tt=[];ctx.imageSmoothingEnabled=!1;ctx.clearRect(0,0,w,h);ctx.fillStyle="#000000";ctx.fillRect(0,0,w,h);ctx.strokeStyle="#808080";ctx.lineWidth=px(.8);ctx.strokeRect(ctx.lineWidth/2,ctx.lineWidth/2,w-ctx.lineWidth,h-ctx.lineWidth);ico?ctx.drawImage(ico,0,0,64,64,px(2),py(2),px(34),py(34)):di(128,0,64,64,2,2,34,34);var now=Date.now(),addr=0;ds(38,4,st.n,255,255,255,0,now);if(0<=st.p){0<st.m1.length&&ds(38,15,st.m1,255,255,255,0,now);null!=st.m2?ds(38,27,st.m2,255,255,255,0,now):(addr=1,!cfg.hideAddr&&ds(38,27,cfg.addr,48,48,48,0,now))}else{5e3>now-conn?(dirty=1,Math.floor(now/300)%4,ds(38,15,"",128,128,128,0,now)):ds(38,15,"",96,96,96,0,now);addr=1;!cfg.hideAddr&&ds(38,27,cfg.addr,48,48,48,0,now)}var hov=over&&240<=mx&&256>=mx&&1<=my&&11>=my;if(0<=st.p){hov&&(tt=[st.p+"ms"]);var pc=st.on+"/"+st.mx,pcx=241-sw(pc);ds(pcx,3,pc,128,128,128,0);di(128,80+8*(150>st.p?0:300>st.p?1:600>st.p?2:1e3>st.p?3:4),10,7,243,3)}else 5e3>now-conn?(dirty=1,hov&&(tt=["Pinging..."]),di(138,80+8*Math.abs(Math.floor(now/100)%8-4),10,7,243,3)):(hov&&(tt=["(no connection)"]),di(128,120,10,7,243,3));0<=st.p&&st.c&&(di(144,64,16,16,243,25,10,10),over&&239<=mx&&256>=mx&&22<=my&&36>=my&&(tt=["Server is cracked"]));tt&&over&&0!=tt.length?showtip&&settip(tt):tipcv.style.display="none"}},settip=t=>{var s=t.join();if(s!==tip||lastw!==w){for(var mw=0,i=0;i<t.length;++i)mw=Math.max(mw,sw(t[i]));var tw=1===t.length?Math.ceil(.9*mw)+6:mw+6,th=1===t.length?9*t.length+4:8*t.length+6;tipcv.width=px(tw);tipcv.height=py(th);var octx=ctx;ctx=tipctx;ctx.imageSmoothingEnabled=!1;ctx.clearRect(0,0,tipcv.width,tipcv.height);var lw=px(1);ctx.fillStyle="#110210";ctx.beginPath();ctx.roundRect(0,0,tipcv.width,tipcv.height,px(.5));ctx.fill();var gr=ctx.createLinearGradient(0,lw,0,tipcv.height-lw);gr.addColorStop(0,"#25015b");gr.addColorStop(1,"#180132");ctx.strokeStyle=gr;ctx.lineWidth=lw;ctx.beginPath();ctx.roundRect(lw,lw,tipcv.width-2*lw,tipcv.height-2*lw,px(.5));ctx.stroke();ctx.fillStyle="#110110";ctx.beginPath();ctx.roundRect(2*lw,2*lw,tipcv.width-4*lw,tipcv.height-4*lw,px(.5));ctx.fill();ctx.save();ctx.scale(.9,.9);for(i=0;i<t.length;++i)ds(3/.9,2/.9+9*i/.9,t[i],256,256,256,1);ctx.restore();ctx=octx;tip=s;lastw=w}if(over){tipcv.style.display="block";var l=mpx+px(4),t2=mpy-py(9);mpx+tipcv.width+2>window.innerWidth&&(l=window.innerWidth-tipcv.width-2);mpy+tipcv.height+2>window.innerHeight&&0>(t2=window.innerHeight-tipcv.height-2)&&(t2=0);tipcv.style.left=l+"px";tipcv.style.top=t2+"px"}else tipcv.style.display="none"},mm=e=>{over=1;mx=e.offsetX/w*256;my=e.offsetY/h*38;mpx=e.clientX;mpy=e.clientY;dirty=1};cv.addEventListener("mouseover",mm);cv.addEventListener("mousemove",mm);cv.addEventListener("mouseout",()=>{over=0;tipcv.style.display="none";dirty=1});img.addEventListener("load",()=>{loaded=1;setInterval(draw,16)});img.src=cfg.spritesheet;var addr=cfg.addr;0!=addr.indexOf("ws://")&&0!=addr.indexOf("wss://")&&(addr=(0==location.href.indexOf("https:")?"wss":"ws")+"://"+addr);st={n:cfg.name,c:0,pt:Date.now(),p:-1,m1:"",m2:null,on:0,mx:0};dirty=1;conn=Date.now();var ws=new WebSocket(addr);ws.binaryType="arraybuffer";ws.onopen=()=>ws.send("Accept: MOTD");ws.onmessage=e=>{if(e.data){if("string"==typeof e.data){try{var d=JSON.parse(e.data);if("motd"===d.type.toLowerCase()){dirty=1;0<st.pt&&(st.p=Date.now()-st.pt,st.pt=0);st.n=cfg.force?cfg.name:d.name;st.c=d.cracked||0;var m=d.data.motd;m&&0<m.length&&(st.m1=m[0],1<m.length&&(st.m2=m[1]));st.on=d.data.online;st.mx=d.data.max}}catch(x){ws.close()}}else if(16384==(d=new Uint8Array(e.data)).length){ico||(ico=document.createElement("canvas"),ico.width=64,ico.height=64,icoctx=ico.getContext("2d"));var id=icoctx.createImageData(64,64);for(var i=0;i<16384;++i)id.data[i]=d[i];icoctx.putImageData(id,0,0);dirty=1}}};ws.onclose=()=>{conn=0;dirty=1};ws.onerror=()=>{ws.close();conn=0;dirty=1};showtip=1;
