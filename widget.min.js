var chars=[1,9,9,8,8,8,8,7,9,8,9,9,8,9,9,9,8,8,8,8,9,9,8,9,8,8,8,8,8,9,9,9,4,2,5,6,6,6,6,3,5,5,5,6,2,6,2,6,6,6,6,6,6,6,6,6,6,6,2,2,5,6,5,6,7,6,6,6,6,6,6,6,6,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,4,6,6,3,6,6,6,6,6,5,6,6,2,6,5,3,6,6,6,6,6,6,6,4,6,6,6,6,6,6,5,2,5,7,6,6,6,6,6,6,6,6,6,6,6,6,4,6,3,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,6,3,6,6,6,6,6,6,6,7,6,6,6,2,6,6,8,9,9,6,6,6,8,8,6,8,8,8,8,8,6,6,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,9,9,9,5,9,9,8,7,7,8,7,8,8,8,7,8,8,7,9,9,6,7,7,7,7,7,9,6,7,8,7,6,6,9,7,6,7,1],config=window.eaglercraftXPreview,widget=config.widget,width=widget.clientWidth,height=Math.floor(.1484375*width);widget.style.width=width+"px",widget.style.height=height+"px",widget.style.backgroundColor="black";var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height,widget.appendChild(canvas);var ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=!1;var ltgx=document.createElement("canvas");ltgx.width=64,ltgx.height=64;var aa=ltgx.getContext("2d");aa.imageSmoothingEnabled=!1;var spritesheet=new Image,spriteload=!1,serv={n:config.name,c:!1,pt:0,p:-1,m1:"",m2:null,on:0,mx:0},redraw=!0,ctime=0,icon1=null,iconctx=null,tiptext="",tipenabled=!1,tipcanvas=document.createElement("canvas");tipcanvas.width=64,tipcanvas.height=64,tipcanvas.style.display="none",tipcanvas.style.position="fixed",tipcanvas.style.zIndex="100",tipcanvas.style.pointerEvents="none",document.body.appendChild(tipcanvas);var tipctx=tipcanvas.getContext("2d");tipctx.imageSmoothingEnabled=!1;var mx=0,my=0,pagex=0,pagey=0,hover=!1,dtimer=0,lasttipw=0,scalex=function(e){return e*width/256},scaley=function(e){return e*height/38},drawimg=function(e,t,a,r,i,c,n,_){spriteload&&ctx.drawImage(spritesheet,e+.05,t+.05,a-.1,r-.1,scalex(i),scaley(c),scalex(n||a),scaley(_||r))},drawchar=function(e,t,a,r){return a>=chars.length&&(a=176),r?(ctx.resetTransform(),ctx.scale(width/256,height/38),ctx.translate(e+1.1,t),ctx.transform(1,0,-.35,1,0,0),ctx.drawImage(spritesheet,a%16*8,8*Math.floor(a/16),.99*chars[a],7.92,0,0,chars[a],8),ctx.resetTransform()):drawimg(a%16*8,8*Math.floor(a/16),chars[a],8,e,t),chars[a]},drawcolorchar=function(e,t,a,r,i){return a>=chars.length&&(a=176),spriteload&&(aa.globalCompositeOperation="source-over",aa.clearRect(0,0,8,8),aa.imageSmoothingEnabled=!1,aa.drawImage(spritesheet,a%16*8,8*Math.floor(a/16),.99*chars[a],7.92,0,0,chars[a],8),aa.globalCompositeOperation="source-in",aa.fillStyle=r,aa.fillRect(0,0,chars[a],8),i?(ctx.resetTransform(),ctx.scale(width/256,height/38),ctx.translate(e+1.1,t),ctx.transform(1,0,-.35,1,0,0),ctx.drawImage(ltgx,0,0,.99*chars[a],7.92,0,0,chars[a],8),ctx.resetTransform()):ctx.drawImage(ltgx,0,0,.99*chars[a],7.92,scalex(e),scaley(t),scalex(chars[a]),scaley(8))),chars[a]},drawline=function(e,t,a,r){ctx.fillStyle=r,ctx.fillRect(scalex(e),scaley(t),scalex(a+.02),scaley(1))},GETRGB=function(e,t,a){return"rgba("+Math.floor(e)+","+Math.floor(t)+","+Math.floor(a)+",1.0)"},strwidth=function(e,t){t=t?t.charCodeAt(0):167;for(var a=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i===t?r+=2:a=i<chars.length?a+chars[i]:a+6}return a},drawstr=function(e,t,a,r,i,c,n,_,s){var $=s;s=s?s.charCodeAt(0):167;var d=e,l=t;n&&(e++,t++),_=_||3492589035;for(var o=!1,h=r,v=i,g=c,w=!1,x=!1,p=!1,m=!1,f=!1,y=0;y<a.length;++y){var u=a.charCodeAt(y);if(u===s)o=!0;else if(o)48===u?(h=0,v=0,g=0,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):49===u?(h=0,v=0,g=170,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):50===u?(h=0,v=170,g=0,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):51===u?(h=0,v=170,g=170,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):52===u?(h=170,v=0,g=0,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):53===u?(h=170,v=0,g=170,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):54===u?(h=255,v=170,g=0,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):55===u?(h=170,v=170,g=170,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):56===u?(h=85,v=85,g=85,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):57===u?(h=85,v=85,g=255,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):97===u?(h=85,v=255,g=85,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):98===u?(h=85,v=255,g=255,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):99===u?(h=255,v=85,g=85,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):100===u?(h=255,v=85,g=255,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):101===u?(h=255,v=255,g=85,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):102===u?(h=255,v=255,g=255,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):107===u?(o=!1,w=!0):108===u?(o=!1,x=!0):109===u?(o=!1,p=!0):110===u?(o=!1,m=!0):111===u?(o=!1,f=!0):114===u?(h=r,v=i,g=c,o=!1,w=!1,x=!1,p=!1,m=!1,f=!1):o=!1;else{if(w){redraw=!0;var b,E=6;u<chars.length&&(E=chars[u]);var S=0;do{var C=_+=1831565813;C=Math.imul(C^C>>>15,1|C),C^=C+Math.imul(C^C>>>7,61|C),b=C=((C^C>>>14)>>>0)/429496&255}while((b===u||chars[b]!==E)&&1e3>++S);u=b}if(n){var R=GETRGB(.247*h,.247*v,.247*g),W=e;x&&drawcolorchar(e+1,t,u,R,f);var F=drawcolorchar(e,t,u,R,f);e+=F,x&&(e++,F++),p&&drawline(W,t+4,F,R),m&&drawline(W,t+8,F,R)}else if(h>=250&&v>=250&&g>=250){var W=e;x&&drawchar(e+1,t,u,f);var F=drawchar(e,t,u,f);e+=F,x&&(e++,F++),p&&drawline(W,t+4,F,"#FFFFFF"),m&&drawline(W,t+8,F,"#FFFFFF")}else{var R=GETRGB(h,v,g),W=e;x&&drawcolorchar(e+1,t,u,R,f);var F=drawcolorchar(e,t,u,R,f);e+=F,x&&(e++,F++),p&&drawline(W,t+4,F,R),m&&drawline(W,t+8,F,R)}if(e>250)break}}n&&drawstr(d,l,a,r,i,c,!1,_,$)};function render(){if(redraw||hover&&0==++dtimer%2||width!==widget.clientWidth){redraw=!1,width!==widget.clientWidth&&(height=Math.floor(.1484375*widget.clientWidth),widget.style.height=height+"px",width=widget.clientWidth,height=widget.clientHeight,canvas.width=width,canvas.height=height);var e=[];ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,width,height),ctx.fillStyle="#000000",ctx.fillRect(0,0,width,height),ctx.strokeStyle="#808080",ctx.lineWidth=scalex(.8),ctx.strokeRect(ctx.lineWidth/2,ctx.lineWidth/2,width-ctx.lineWidth,height-ctx.lineWidth),icon1?ctx.drawImage(icon1,0,0,64,64,scalex(2),scaley(2),scalex(34),scaley(34)):drawimg(128,0,64,64,2,2,34,34);var t=Date.now(),a=!1;drawstr(38,4,serv.n,255,255,255,0,t),serv.p>=0?(serv.m1.length>0&&drawstr(38,15,serv.m1,255,255,255,0,t),null!==serv.m2?drawstr(38,27,serv.m2,255,255,255,0,t):(a=!0,config.hideAddr||drawstr(38,27,config.addr,48,48,48,0,t))):(t-ctime<5e3?(redraw=!0,drawstr(38,15,"",128,128,128,0,t)):drawstr(38,15,"",96,96,96,0,t),a=!0,config.hideAddr||drawstr(38,27,config.addr,48,48,48,0,t));var r=hover&&mx>=240&&mx<=256&&my>=1&&my<=11;if(serv.p>=0){r&&(e=[serv.p+"ms"]);var i=serv.on+"/"+serv.mx,c=241-strwidth(i);drawstr(c,3,i,128,128,128,0);var n=80;serv.p<150?n+=0:serv.p<300?n+=8:serv.p<600?n+=16:serv.p<1e3?n+=24:n+=32,drawimg(128,n,10,7,243,3)}else t-ctime<5e3?(redraw=!0,r&&(e=["Pinging..."]),drawimg(138,80+8*Math.abs(Math.floor(t/100)%8-4),10,7,243,3)):(r&&(e=["(no connection)"]),drawimg(128,120,10,7,243,3));serv.p>=0&&serv.c&&(drawimg(144,64,16,16,243,25,10,10),hover&&mx>=239&&mx<=256&&my>=22&&my<=36&&(e=["Server is cracked"])),e&&hover&&0!==e.length?tipenabled&&updatetip(e):tipcanvas.style.display="none"}}var updatetip=function(e){var t=e.join();if(t!==tiptext||lasttipw!==width){for(var a=0,r=0;r<e.length;++r)a=Math.max(a,strwidth(e[r]));var i=1===e.length?Math.ceil(.9*a)+6:a+6,c=1===e.length?9*e.length+4:8*e.length+6;tipcanvas.width=scalex(i),tipcanvas.height=scaley(c);var n=ctx;(ctx=tipctx).imageSmoothingEnabled=!1,ctx.clearRect(0,0,tipcanvas.width,tipcanvas.height);var _=scalex(1);ctx.fillStyle="#110210",ctx.beginPath(),ctx.roundRect(0,0,tipcanvas.width,tipcanvas.height,scalex(.5)),ctx.fill();var s=ctx.createLinearGradient(0,_,0,tipcanvas.height-_);for(s.addColorStop(0,"#25015b"),s.addColorStop(1,"#180132"),ctx.strokeStyle=s,ctx.lineWidth=_,ctx.beginPath(),ctx.roundRect(_,_,tipcanvas.width-2*_,tipcanvas.height-2*_,scalex(.5)),ctx.stroke(),ctx.fillStyle="#110110",ctx.beginPath(),ctx.roundRect(2*_,2*_,tipcanvas.width-4*_,tipcanvas.height-4*_,scalex(.5)),ctx.fill(),ctx.save(),ctx.scale(.9,.9),r=0;r<e.length;++r)drawstr(3/.9,2/.9+9*r/.9,e[r],256,256,256,!0);ctx.restore(),ctx=n,tiptext=t,lasttipw=width}if(hover){tipcanvas.style.display="block";var $=pagex+scalex(4),d=pagey-scaley(9);pagex+tipcanvas.width+2>window.innerWidth&&($=window.innerWidth-tipcanvas.width-2),pagey+tipcanvas.height+2>window.innerHeight&&(d=window.innerHeight-tipcanvas.height-2)<0&&(d=0),tipcanvas.style.left=$+"px",tipcanvas.style.top=d+"px"}else tipcanvas.style.display="none"},mousemove=function(e){hover=!0,mx=e.offsetX/width*256,my=e.offsetY/height*38,pagex=e.clientX,pagey=e.clientY,redraw=!0};canvas.addEventListener("mouseover",mousemove),canvas.addEventListener("mousemove",mousemove),canvas.addEventListener("mouseout",function(){hover=!1,tipcanvas.style.display="none",redraw=!0}),spritesheet.addEventListener("load",function(){spriteload=!0,setInterval(render,16)}),spritesheet.src=config.spritesheet;var servaddr=config.addr;0!==servaddr.indexOf("ws://")&&0!==servaddr.indexOf("wss://")&&(servaddr=0===location.href.indexOf("https:")?"wss://"+servaddr:"ws://"+servaddr),serv={n:config.name,c:!1,pt:Date.now(),p:-1,m1:"",m2:null,on:0,mx:0},redraw=!0,ctime=Date.now();var ws=new WebSocket(servaddr);ws.binaryType="arraybuffer",ws.onopen=function(){ws.send("Accept: MOTD")},ws.onmessage=function(e){if(e.data){if("string"==typeof e.data)try{var t=JSON.parse(e.data);if("motd"===t.type){redraw=!0,serv.pt>0&&(serv.p=Date.now()-serv.pt,serv.pt=0),serv.n=config.force?config.name:t.name,serv.c=t.cracked||!1;var a=t.data.motd;a&&a.length>0&&(serv.m1=a[0],a.length>1&&(serv.m2=a[1])),serv.on=t.data.online,serv.mx=t.data.max}}catch(r){ws.close()}else if(16384===(t=new Uint8Array(e.data)).length){icon1||((icon1=document.createElement("canvas")).width=64,icon1.height=64,iconctx=icon1.getContext("2d"));for(var i=iconctx.createImageData(64,64),c=0;c<16384;++c)i.data[c]=t[c];iconctx.putImageData(i,0,0),redraw=!0}}},ws.onclose=function(){ctime=0,redraw=!0},ws.onerror=function(){ws.close(),ctime=0,redraw=!0},tipenabled=!0;
