var chars=[1,9,9,8,8,8,8,7,9,8,9,9,8,9,9,9,8,8,8,8,9,9,8,9,8,8,8,8,8,9,9,9,4,2,5,6,6,6,6,3,5,5,5,6,2,6,2,6,6,6,6,6,6,6,6,6,6,6,2,2,5,6,5,6,7,6,6,6,6,6,6,6,6,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,4,6,6,3,6,6,6,6,6,5,6,6,2,6,5,3,6,6,6,6,6,6,6,4,6,6,6,6,6,6,5,2,5,7,6,6,6,6,6,6,6,6,6,6,6,6,4,6,3,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,6,3,6,6,6,6,6,6,6,7,6,6,6,2,6,6,8,9,9,6,6,6,8,8,6,8,8,8,8,8,6,6,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,9,9,9,5,9,9,8,7,7,8,7,8,8,8,7,8,8,7,9,9,6,7,7,7,7,7,9,6,7,8,7,6,6,9,7,6,7,1],config=window.eaglercraftXPreview;function dbg_g(...e){let t=new Date,a=t.toTimeString().split(" ")[0],r=t.getMilliseconds().toString().padStart(3,"0");return["["+a+"+"+r+"] [EaglerXPreview]:",...e]}function dbg(...e){console.log(...dbg_g(...e))}function dbg_w(...e){console.warn(...dbg_g(...e))}function dbg_e(...e){throw Error(dbg_g(...e).join(" "))}config||dbg_e("You must supply window.eaglercraftXPreview");var widget=config.widget,width=widget.clientWidth,ratio="relay"===config.type?.09375:.1484375,height=Math.floor(width*ratio);widget.style.width=width+"px",widget.style.height=height+"px",widget.style.backgroundColor="black";var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height,widget.appendChild(canvas);var ctx=canvas.getContext("2d");ctx.imageSmoothingEnabled=!1;var ltgx=document.createElement("canvas");ltgx.width=64,ltgx.height=64;var aa=ltgx.getContext("2d");aa.imageSmoothingEnabled=!1;var spritesheet=new Image,spriteload=!1,serv={n:config.name,c:!1,p:-1,m1:"",m2:null,skip:!1,on:0,mx:0},redraw=!0,ctime=0,icon1=null,iconctx=null,tiptext="",tipcanvas=document.createElement("canvas");tipcanvas.width=64,tipcanvas.height=64,tipcanvas.style.display="none",tipcanvas.style.position="fixed",tipcanvas.style.zIndex="100",tipcanvas.style.pointerEvents="none",document.body.appendChild(tipcanvas);var tipctx=tipcanvas.getContext("2d");tipctx.imageSmoothingEnabled=!1;var mx=0,my=0,pagex=0,pagey=0,hover=!1,dtimer=0,lasttipw=0,scalex=function(e){return e*width/256},scaley=function(e){return"relay"===config.type?e*height/38*(38/24):e*height/38},drawimg=function(e,t,a,r,i,n,c,s){spriteload&&ctx.drawImage(spritesheet,e+.05,t+.05,a-.1,r-.1,scalex(i),scaley(n),scalex(c||a),scaley(s||r))},drawchar=function(e,t,a,r){return a>=chars.length&&(a=176),r?(ctx.resetTransform(),ctx.scale(width/256,height/38),ctx.translate(e+1.1,t),ctx.transform(1,0,-.35,1,0,0),ctx.drawImage(spritesheet,a%16*8,8*Math.floor(a/16),.99*chars[a],7.92,0,0,chars[a],8),ctx.resetTransform()):drawimg(a%16*8,8*Math.floor(a/16),chars[a],8,e,t),chars[a]},drawcolorchar=function(e,t,a,r,i){return a>=chars.length&&(a=176),spriteload&&(aa.globalCompositeOperation="source-over",aa.clearRect(0,0,8,8),aa.imageSmoothingEnabled=!1,aa.drawImage(spritesheet,a%16*8,8*Math.floor(a/16),.99*chars[a],7.92,0,0,chars[a],8),aa.globalCompositeOperation="source-in",aa.fillStyle=r,aa.fillRect(0,0,chars[a],8),i?(ctx.resetTransform(),ctx.scale(width/256,height/38),ctx.translate(e+1.1,t),ctx.transform(1,0,-.35,1,0,0),ctx.drawImage(ltgx,0,0,.99*chars[a],7.92,0,0,chars[a],8),ctx.resetTransform()):ctx.drawImage(ltgx,0,0,.99*chars[a],7.92,scalex(e),scaley(t),scalex(chars[a]),scaley(8))),chars[a]},drawline=function(e,t,a,r){ctx.fillStyle=r,ctx.fillRect(scalex(e),scaley(t),scalex(a+.02),scaley(1))},GETRGB=function(e,t,a){return"rgba("+Math.floor(e)+","+Math.floor(t)+","+Math.floor(a)+",1.0)"},strwidth=function(e,t){t=t?t.charCodeAt(0):167;for(var a=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i===t?r+=2:a=i<chars.length?a+chars[i]:a+6}return a},drawstr=function(e,t,a,r,i,n,c,s,o){var _=o;o=o?o.charCodeAt(0):167;var d=e,$=t;c&&(e++,t++),s=s||3492589035;for(var l=!1,g=r,h=i,v=n,p=!1,w=!1,f=!1,m=!1,x=!1,y=0;y<a.length;++y){var u=a.charCodeAt(y);if(u===o)l=!0;else if(l)48===u?(g=0,h=0,v=0,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):49===u?(g=0,h=0,v=170,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):50===u?(g=0,h=170,v=0,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):51===u?(g=0,h=170,v=170,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):52===u?(g=170,h=0,v=0,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):53===u?(g=170,h=0,v=170,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):54===u?(g=255,h=170,v=0,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):55===u?(g=170,h=170,v=170,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):56===u?(g=85,h=85,v=85,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):57===u?(g=85,h=85,v=255,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):97===u?(g=85,h=255,v=85,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):98===u?(g=85,h=255,v=255,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):99===u?(g=255,h=85,v=85,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):100===u?(g=255,h=85,v=255,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):101===u?(g=255,h=255,v=85,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):102===u?(g=255,h=255,v=255,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):107===u?(l=!1,p=!0):108===u?(l=!1,w=!0):109===u?(l=!1,f=!0):110===u?(l=!1,m=!0):111===u?(l=!1,x=!0):114===u?(g=r,h=i,v=n,l=!1,p=!1,w=!1,f=!1,m=!1,x=!1):l=!1;else{if(p){redraw=!0;var b,S=6;u<chars.length&&(S=chars[u]);var k=0;do{var R=s+=1831565813;R=Math.imul(R^R>>>15,1|R),R^=R+Math.imul(R^R>>>7,61|R),b=R=((R^R>>>14)>>>0)/429496&255}while((b===u||chars[b]!==S)&&1e3>++k);u=b}if(c){var E=GETRGB(.247*g,.247*h,.247*v),C=e;w&&drawcolorchar(e+1,t,u,E,x);var T=drawcolorchar(e,t,u,E,x);e+=T,w&&(e++,T++),f&&drawline(C,t+4,T,E),m&&drawline(C,t+8,T,E)}else if(g>=250&&h>=250&&v>=250){var C=e;w&&drawchar(e+1,t,u,x);var T=drawchar(e,t,u,x);e+=T,w&&(e++,T++),f&&drawline(C,t+4,T,"#FFFFFF"),m&&drawline(C,t+8,T,"#FFFFFF")}else{var E=GETRGB(g,h,v),C=e;w&&drawcolorchar(e+1,t,u,E,x);var T=drawcolorchar(e,t,u,E,x);e+=T,w&&(e++,T++),f&&drawline(C,t+4,T,E),m&&drawline(C,t+8,T,E)}if(e>250)break}}c&&drawstr(d,$,a,r,i,n,!1,s,_)};function render(){var e=38;if("relay"===config.type&&(e=25),redraw||hover&&0==++dtimer%2||width!==widget.clientWidth){redraw=!1;var t=[];ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,width,height),ctx.fillStyle="#000000",ctx.fillRect(0,0,width,height),ctx.strokeStyle="#808080",ctx.lineWidth=scalex(.8),ctx.strokeRect(ctx.lineWidth/2,ctx.lineWidth/2,width-ctx.lineWidth,height-ctx.lineWidth),"server"===config.type&&(icon1?ctx.drawImage(icon1,0,0,64,64,scalex(2),scaley(2),scalex(34),scaley(34)):drawimg(128,0,64,64,2,2,34,34));var a=Date.now(),r=!1;"relay"===config.type?drawstr(e,4,serv.n,255,255,255,1,a):drawstr(e,4,serv.n,255,255,255,0,a),"relay"===config.type?config.hideAddr||drawstr(e,14,config.addr,153,153,153,1,a):serv.p>=0?(serv.m1.length>0&&drawstr(e,15,serv.m1,255,255,255,0,a),null!==serv.m2?drawstr(e,27,serv.m2,255,255,255,0,a):(r=!0,config.hideAddr||drawstr(e,27,config.addr,48,48,48,0,a))):(a-ctime<5e3?(redraw=!0,drawstr(e,15,"",128,128,128,0,a)):drawstr(e,15,"",96,96,96,0,a),r=!0,config.hideAddr||drawstr(e,27,config.addr,48,48,48,0,a));var i=["Pinging..."];"relay"===config.type&&(i[0]="Polling...");var n=hover&&mx>=240&&mx<=256&&my>=1&&my<=11;if(serv.p>=0){n&&(t=[serv.p+"ms"]);var c="";serv.skip||(c=serv.on+"/"+serv.mx),drawstr(241-strwidth(c),3,c,128,128,128,0);var s=80;serv.p<150?s+=0:serv.p<300?s+=8:serv.p<600?s+=16:serv.p<1e3?s+=24:s+=32,drawimg(128,s,10,7,243,3)}else a-ctime<5e3?(redraw=!0,n&&(t=i),drawimg(138,80+8*Math.abs(Math.floor(a/100)%8-4),10,7,243,3)):(n&&(t=["(no connection)"]),drawimg(128,120,10,7,243,3));serv.p>=0&&serv.c&&(drawimg(144,64,16,16,243,25,10,10),hover&&mx>=239&&mx<=256&&my>=22&&my<=36&&(t=["Server is cracked"])),t&&hover&&0!==t.length?updatetip(t):tipcanvas.style.display="none"}}var updatetip=function(e){var t=e.join();if(t!==tiptext||lasttipw!==width){for(var a=0,r=0;r<e.length;++r)a=Math.max(a,strwidth(e[r]));var i=1===e.length?Math.ceil(.9*a)+6:a+6,n=1===e.length?9*e.length+4:8*e.length+6;tipcanvas.width=scalex(i),tipcanvas.height=scaley(n);var c=ctx;(ctx=tipctx).imageSmoothingEnabled=!1,ctx.clearRect(0,0,tipcanvas.width,tipcanvas.height);var s=scalex(1);ctx.fillStyle="#110210",ctx.beginPath(),ctx.roundRect(0,0,tipcanvas.width,tipcanvas.height,scalex(.5)),ctx.fill();var o=ctx.createLinearGradient(0,s,0,tipcanvas.height-s);for(o.addColorStop(0,"#25015b"),o.addColorStop(1,"#180132"),ctx.strokeStyle=o,ctx.lineWidth=s,ctx.beginPath(),ctx.roundRect(s,s,tipcanvas.width-2*s,tipcanvas.height-2*s,scalex(.5)),ctx.stroke(),ctx.fillStyle="#110110",ctx.beginPath(),ctx.roundRect(2*s,2*s,tipcanvas.width-4*s,tipcanvas.height-4*s,scalex(.5)),ctx.fill(),ctx.save(),ctx.scale(.9,.9),r=0;r<e.length;++r)drawstr(3/.9,2/.9+9*r/.9,e[r],256,256,256,!0);ctx.restore(),ctx=c,tiptext=t,lasttipw=width}if(hover){tipcanvas.style.display="block";var _=pagex+scalex(4),d=pagey-scaley(9);pagex+tipcanvas.width+2>window.innerWidth&&(_=window.innerWidth-tipcanvas.width-2),pagey+tipcanvas.height+2>window.innerHeight&&(d=window.innerHeight-tipcanvas.height-2)<0&&(d=0),tipcanvas.style.left=_+"px",tipcanvas.style.top=d+"px"}else tipcanvas.style.display="none"},mousemove=function(e){hover=!0,mx=e.offsetX/width*256,my=e.offsetY/height*38,pagex=e.clientX,pagey=e.clientY,redraw=!0};canvas.addEventListener("mouseover",mousemove),canvas.addEventListener("mousemove",mousemove),canvas.addEventListener("mouseout",function(){hover=!1,tipcanvas.style.display="none",redraw=!0}),spritesheet.addEventListener("load",function(){spriteload=!0,dbg("Spritesheet loaded with size",width,"x",height),setInterval(render,16)}),spritesheet.src=config.spritesheet,serv={n:config.name,c:!1,p:-1,m1:"",m2:null,skip:!1,on:0,mx:0},redraw=!0,ctime=Date.now(),dbg("Connecting to "+config.addr);var ws=new WebSocket(config.addr);ws.binaryType="arraybuffer",ws.onopen=function(){dbg("Connected to "+config.addr),"server"===config.type?(ws.send("Accept: MOTD"),dbg('Sent "Accept: MOTD"')):"relay"===config.type&&(ws.send(new Uint8Array([0,3,1,0])),dbg("Sent",new Uint8Array([0,3,1,0])))},ws.onmessage=function(e){if(e.data){if(function(){try{return JSON.parse(e.data),!0}catch{return}}()&&"server"===config.type)try{var t=JSON.parse(e.data);if(dbg("Received server info",t),"motd"===t.type){redraw=!0,dbg("Timestamp:",Math.floor(e.timeStamp)+"ms"),-1===serv.p&&(serv.p=Math.floor(e.timeStamp)),dbg("Server name:",t.name),dbg("Server brand:",t.brand),serv.n=config.force?config.name:t.name,serv.c=t.cracked,serv.c&&dbg_w("Server is cracked");var a=t.data.motd;a&&a.length>0&&(serv.m1=a[0],a.length>1&&(serv.m2=a[1])),serv.on=t.data.online,serv.mx=t.data.max}else"blocked"===t.type&&(dbg_w("Server has blocked you temporarily, retrying in 5 seconds"),setTimeout(function(){dbg_w("Server has blocked you temporarily, retrying in 4 seconds"),setTimeout(function(){dbg_w("Server has blocked you temporarily, retrying in 3 seconds"),setTimeout(function(){dbg_w("Server has blocked you temporarily, retrying in 2 seconds"),setTimeout(function(){dbg_w("Server has blocked you temporarily, retrying in 1 seconds"),setTimeout(function(){window.location.reload()},1e3)},1e3)},1e3)},1e3)},1e3))}catch(r){dbg_w("Malformed server info packet",JSON.parse(e.data))}else if(16384===(t=new Uint8Array(e.data)).length&&"server"===config.type){dbg("Received server icon",new Uint8Array(e.data)),icon1||((icon1=document.createElement("canvas")).width=64,icon1.height=64,iconctx=icon1.getContext("2d"));for(var i=iconctx.createImageData(64,64),n=0;n<16384;++n)i.data[n]=t[n];iconctx.putImageData(i,0,0),redraw=!0}else if(105===(t=new Uint8Array(e.data))[0]&&"relay"===config.type){var t=new Uint8Array(e.data);if(dbg("Received relay info",t),dbg("Timestamp:",Math.floor(e.timeStamp)+"ms"),serv.skip=!0,-1===serv.p&&(serv.p=Math.floor(e.timeStamp)),0!==t[2]){var c=new TextDecoder().decode(t.slice(3,3+t[2]));serv.n=config.force?config.name:c,dbg("Relay server comment:",c),dbg("Relay server brand:",new TextDecoder().decode(t.slice(3+t[2]+1,3+t[2]+1+t[3+t[2]])))}else dbg("No relay server comment")}else{ws.close();var s=new Uint8Array(e.data);"object"==typeof e.data&&0!==s.length?dbg_w("Received unknown packet",s):dbg_w("Received unknown packet",'"'+e.data+'"')}}},ws.onclose=function(){ctime=0,redraw=!0,dbg("Connection closed")},ws.onerror=function(){ws.close(),ctime=0,redraw=!0};