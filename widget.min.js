!function(){let e=window.eaglercraftXPreview;var t=[1,9,9,8,8,8,8,7,9,8,9,9,8,9,9,9,8,8,8,8,9,9,8,9,8,8,8,8,8,9,9,9,4,2,5,6,6,6,6,3,5,5,5,6,2,6,2,6,6,6,6,6,6,6,6,6,6,6,2,2,5,6,5,6,7,6,6,6,6,6,6,6,6,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,4,6,6,3,6,6,6,6,6,5,6,6,2,6,5,3,6,6,6,6,6,6,6,4,6,6,6,6,6,6,5,2,5,7,6,6,6,6,6,6,6,6,6,6,6,6,4,6,3,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,6,6,3,6,6,6,6,6,6,6,7,6,6,6,2,6,6,8,9,9,6,6,6,8,8,6,8,8,8,8,8,6,6,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,6,9,9,9,5,9,9,8,7,7,8,7,8,8,8,7,8,8,7,9,9,6,7,7,7,7,7,9,6,7,8,7,6,6,9,7,6,7,1];function n(...e){let t=new Date,n=t.toTimeString().split(" ")[0],_=t.getMilliseconds().toString().padStart(3,"0");return["["+n+"+"+_+"] [EaglerXPreview]:",...e]}function _(...e){console.log(...n(...e))}function r(...e){console.warn(...n(...e))}e||function e(...t){throw Error(n(...t).join(" "))}("You must supply window.eaglercraftXPreview");var a=e.widget,$=a.clientWidth,i=Math.floor($*("relay"===e.type?.09375:.1484375));a.style.width=$+"px",a.style.height=i+"px",a.style.backgroundColor="black";var o=document.createElement("canvas");o.width=$,o.height=i,a.appendChild(o);var l=o.getContext("2d");l.imageSmoothingEnabled=!1;var d=document.createElement("canvas");d.width=64,d.height=64;var c=d.getContext("2d");c.imageSmoothingEnabled=!1;var s=new Image,h=!1,f={n:e.name,c:!1,p:-1,m1:"",m2:null,skip:!1,on:0,mx:0},m=!0,v=0,p=null,g=null,y="",u=document.createElement("canvas");u.width=64,u.height=64,u.style.display="none",u.style.position="fixed",u.style.zIndex="100",u.style.pointerEvents="none",document.body.appendChild(u);var w=u.getContext("2d");w.imageSmoothingEnabled=!1;var S=0,b=0,k=0,x=0,C=!1,R=0,E=0,F=function(e){return e*$/256},T=function(t){return"relay"===e.type?t*i/38*(38/24):t*i/38},W=function(e,t,n,_,r,a,$,i){h&&l.drawImage(s,e+.05,t+.05,n-.1,_-.1,F(r),T(a),F($||n),T(i||_))},A=function(e,n,_,r){return _>=t.length&&(_=176),r?(l.resetTransform(),l.scale($/256,i/38),l.translate(e+1.1,n),l.transform(1,0,-.35,1,0,0),l.drawImage(s,_%16*8,8*Math.floor(_/16),.99*t[_],7.92,0,0,t[_],8),l.resetTransform()):W(_%16*8,8*Math.floor(_/16),t[_],8,e,n),t[_]},I=function(e,n,_,r,a){return _>=t.length&&(_=176),h&&(c.globalCompositeOperation="source-over",c.clearRect(0,0,8,8),c.imageSmoothingEnabled=!1,c.drawImage(s,_%16*8,8*Math.floor(_/16),.99*t[_],7.92,0,0,t[_],8),c.globalCompositeOperation="source-in",c.fillStyle=r,c.fillRect(0,0,t[_],8),a?(l.resetTransform(),l.scale($/256,i/38),l.translate(e+1.1,n),l.transform(1,0,-.35,1,0,0),l.drawImage(d,0,0,.99*t[_],7.92,0,0,t[_],8),l.resetTransform()):l.drawImage(d,0,0,.99*t[_],7.92,F(e),T(n),F(t[_]),T(8))),t[_]},P=function(e,t,n,_){l.fillStyle=_,l.fillRect(F(e),T(t),F(n+.02),T(1))},L=function(e,t,n){return"rgba("+Math.floor(e)+","+Math.floor(t)+","+Math.floor(n)+",1.0)"},X=function(e,n){n=n?n.charCodeAt(0):167;for(var _=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);a===n?r+=2:_=a<t.length?_+t[a]:_+6}return _},D=function(e,n,_,r,a,$,i,o,l){var d=l;l=l?l.charCodeAt(0):167;var c=e,s=n;i&&(e++,n++),o=o||3492589035;for(var h=!1,f=r,v=a,p=$,g=!1,y=!1,u=!1,w=!1,S=!1,b=0;b<_.length;++b){var k=_.charCodeAt(b);if(k===l)h=!0;else if(h)48===k?(f=0,v=0,p=0,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):49===k?(f=0,v=0,p=170,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):50===k?(f=0,v=170,p=0,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):51===k?(f=0,v=170,p=170,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):52===k?(f=170,v=0,p=0,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):53===k?(f=170,v=0,p=170,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):54===k?(f=255,v=170,p=0,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):55===k?(f=170,v=170,p=170,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):56===k?(f=85,v=85,p=85,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):57===k?(f=85,v=85,p=255,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):97===k?(f=85,v=255,p=85,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):98===k?(f=85,v=255,p=255,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):99===k?(f=255,v=85,p=85,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):100===k?(f=255,v=85,p=255,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):101===k?(f=255,v=255,p=85,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):102===k?(f=255,v=255,p=255,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):107===k?(h=!1,g=!0):108===k?(h=!1,y=!0):109===k?(h=!1,u=!0):110===k?(h=!1,w=!0):111===k?(h=!1,S=!0):114===k?(f=r,v=a,p=$,h=!1,g=!1,y=!1,u=!1,w=!1,S=!1):h=!1;else{if(g){m=!0;var x,C=6;k<t.length&&(C=t[k]);var R=0;do{var E=o+=1831565813;E=Math.imul(E^E>>>15,1|E),E^=E+Math.imul(E^E>>>7,61|E),x=E=((E^E>>>14)>>>0)/429496&255}while((x===k||t[x]!==C)&&1e3>++R);k=x}if(i){var F=L(.247*f,.247*v,.247*p),T=e;y&&I(e+1,n,k,F,S);var W=I(e,n,k,F,S);e+=W,y&&(e++,W++),u&&P(T,n+4,W,F),w&&P(T,n+8,W,F)}else if(f>=250&&v>=250&&p>=250){var T=e;y&&A(e+1,n,k,S);var W=A(e,n,k,S);e+=W,y&&(e++,W++),u&&P(T,n+4,W,"#FFFFFF"),w&&P(T,n+8,W,"#FFFFFF")}else{var F=L(f,v,p),T=e;y&&I(e+1,n,k,F,S);var W=I(e,n,k,F,S);e+=W,y&&(e++,W++),u&&P(T,n+4,W,F),w&&P(T,n+8,W,F)}if(e>250)break}}i&&D(c,s,_,r,a,$,!1,o,d)};function M(){var t=38;if("relay"===e.type&&(t=25),m||C&&0==++R%2||$!==a.clientWidth){m=!1;var n=[];l.imageSmoothingEnabled=!1,l.clearRect(0,0,$,i),l.fillStyle="#000000",l.fillRect(0,0,$,i),l.strokeStyle="#808080",l.lineWidth=F(.8),l.strokeRect(l.lineWidth/2,l.lineWidth/2,$-l.lineWidth,i-l.lineWidth),"server"===e.type&&(p?l.drawImage(p,0,0,64,64,F(2),T(2),F(34),T(34)):W(128,0,64,64,2,2,34,34));var _=Date.now(),r=!1;"relay"===e.type?D(t,4,f.n,255,255,255,1,_):D(t,4,f.n,255,255,255,0,_),"relay"===e.type?e.hideAddr||D(t,14,e.addr,153,153,153,1,_):f.p>=0?(f.m1.length>0&&D(t,15,f.m1,255,255,255,0,_),null!==f.m2?D(t,27,f.m2,255,255,255,0,_):(r=!0,e.hideAddr||D(t,27,e.addr,48,48,48,0,_))):(_-v<5e3?(m=!0,D(t,15,"",128,128,128,0,_)):D(t,15,"",96,96,96,0,_),r=!0,e.hideAddr||D(t,27,e.addr,48,48,48,0,_));var o=["Pinging..."];"relay"===e.type&&(o[0]="Polling...");var d=C&&S>=240&&S<=256&&b>=1&&b<=11;if(f.p>=0){d&&(n=[f.p+"ms"]);var c="";f.skip||(c=f.on+"/"+f.mx),D(241-X(c),3,c,128,128,128,0);var s=80;f.p<150?s+=0:f.p<300?s+=8:f.p<600?s+=16:f.p<1e3?s+=24:s+=32,W(128,s,10,7,243,3)}else _-v<5e3?(m=!0,d&&(n=o),W(138,80+8*Math.abs(Math.floor(_/100)%8-4),10,7,243,3)):(d&&(n=["(no connection)"]),W(128,120,10,7,243,3));f.p>=0&&f.c&&(W(144,64,16,16,243,25,10,10),C&&S>=239&&S<=256&&b>=22&&b<=36&&(n=["Server is cracked"])),n&&C&&0!==n.length?O(n):u.style.display="none"}requestAnimationFrame(M)}var O=function(e){var t=e.join();if(t!==y||E!==$){for(var n=0,_=0;_<e.length;++_)n=Math.max(n,X(e[_]));var r=1===e.length?Math.ceil(.9*n)+6:n+6,a=1===e.length?9*e.length+4:8*e.length+6;u.width=F(r),u.height=T(a);var i=l;(l=w).imageSmoothingEnabled=!1,l.clearRect(0,0,u.width,u.height);var o=F(1);l.fillStyle="#110210",l.beginPath(),l.roundRect(0,0,u.width,u.height,F(.5)),l.fill();var d=l.createLinearGradient(0,o,0,u.height-o);for(d.addColorStop(0,"#25015b"),d.addColorStop(1,"#180132"),l.strokeStyle=d,l.lineWidth=o,l.beginPath(),l.roundRect(o,o,u.width-2*o,u.height-2*o,F(.5)),l.stroke(),l.fillStyle="#110110",l.beginPath(),l.roundRect(2*o,2*o,u.width-4*o,u.height-4*o,F(.5)),l.fill(),l.save(),l.scale(.9,.9),_=0;_<e.length;++_)D(3/.9,2/.9+9*_/.9,e[_],256,256,256,!0);l.restore(),l=i,y=t,E=$}if(C){u.style.display="block";var c=k+F(4),s=x-T(9);k+u.width+2>window.innerWidth&&(c=window.innerWidth-u.width-2),x+u.height+2>window.innerHeight&&(s=window.innerHeight-u.height-2)<0&&(s=0),u.style.left=c+"px",u.style.top=s+"px"}else u.style.display="none"},j=function(e){C=!0,S=e.offsetX/$*256,b=e.offsetY/i*38,k=e.clientX,x=e.clientY,m=!0};o.addEventListener("mouseover",j),o.addEventListener("mousemove",j),o.addEventListener("mouseout",function(){C=!1,u.style.display="none",m=!0}),s.addEventListener("load",function(){h=!0,_("Spritesheet loaded with size",$,"x",i),requestAnimationFrame(M)}),s.src=e.spritesheet,f={n:e.name,c:!1,p:-1,m1:"",m2:null,skip:!1,on:0,mx:0},m=!0,v=Date.now(),_("Connecting to "+e.addr);var Y=new WebSocket(e.addr);Y.binaryType="arraybuffer",Y.onopen=function(){_("Connected to "+e.addr),"server"===e.type?(Y.send("Accept: MOTD"),_('Sent "Accept: MOTD"')):"relay"===e.type&&(Y.send(new Uint8Array([0,3,1,0])),_("Sent",new Uint8Array([0,3,1,0])))},Y.onmessage=function(t){if(t.data){if(function(){try{return JSON.parse(t.data),!0}catch{return}}()&&"server"===e.type)try{var n=JSON.parse(t.data);if(_("Received server info",n),"motd"===n.type){m=!0,_("Timestamp:",Math.floor(t.timeStamp)+"ms"),-1===f.p&&(f.p=Math.floor(t.timeStamp)),_("Server name:",n.name),_("Server brand:",n.brand),f.n=e.force?e.name:n.name,f.c=n.cracked,f.c&&r("Server is cracked");var a=n.data.motd;a&&a.length>0&&(f.m1=a[0],a.length>1&&(f.m2=a[1])),f.on=n.data.online,f.mx=n.data.max}else"blocked"===n.type&&(r("Server has blocked you temporarily, retrying in 5 seconds"),setTimeout(function(){r("Server has blocked you temporarily, retrying in 4 seconds"),setTimeout(function(){r("Server has blocked you temporarily, retrying in 3 seconds"),setTimeout(function(){r("Server has blocked you temporarily, retrying in 2 seconds"),setTimeout(function(){r("Server has blocked you temporarily, retrying in 1 seconds"),setTimeout(function(){window.location.reload()},1e3)},1e3)},1e3)},1e3)},1e3))}catch($){r("Malformed server info packet",JSON.parse(t.data))}else if(16384===(n=new Uint8Array(t.data)).length&&"server"===e.type){_("Received server icon",new Uint8Array(t.data)),p||((p=document.createElement("canvas")).width=64,p.height=64,g=p.getContext("2d"));for(var i=g.createImageData(64,64),o=0;o<16384;++o)i.data[o]=n[o];g.putImageData(i,0,0),m=!0}else if(105===(n=new Uint8Array(t.data))[0]&&"relay"===e.type){var n=new Uint8Array(t.data);if(_("Received relay info",n),_("Timestamp:",Math.floor(t.timeStamp)+"ms"),f.skip=!0,-1===f.p&&(f.p=Math.floor(t.timeStamp)),0!==n[2]){var l=new TextDecoder("iso-8859-1").decode(n.slice(3,3+n[2]));f.n=e.force?e.name:l,_("Relay server comment:",l),_("Relay server brand:",new TextDecoder().decode(n.slice(3+n[2]+1,3+n[2]+1+n[3+n[2]])))}else _("No relay server comment")}else{Y.close();var d=new Uint8Array(t.data);"object"==typeof t.data&&0!==d.length?r("Received unknown packet",d):r("Received unknown packet",'"'+t.data+'"')}}},Y.onclose=function(){v=0,m=!0,_("Connection closed")},Y.onerror=function(){Y.close(),v=0,m=!0}}();